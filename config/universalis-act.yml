version: "3.3"
services:
  nginx:
    image: "karashiiro/universalis-act-nginx:latest"
    networks:
      - "net"
      - "traefik-public"
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: "0.10"
          memory: "128M"
        reservations:
          cpus: "0.05"
          memory: "64M"
      labels:
        - traefik.enable=true
        - traefik.docker.network=traefik-public
        - traefik.constraint-label=traefik-public
        - traefik.http.routers.universalis-act-http.rule=Host(`act.universalis.app`)
        - traefik.http.routers.universalis-act-http.entrypoints=http
        - traefik.http.routers.universalis-act-http.middlewares=https-redirect
        - traefik.http.routers.universalis-act-https.rule=Host(`act.universalis.app`)
        - traefik.http.routers.universalis-act-https.entrypoints=https
        - traefik.http.routers.universalis-act-https.tls=true
        - traefik.http.routers.universalis-act-https.tls.certresolver=le
        - traefik.http.services.universalis-act.loadbalancer.server.port=80
networks:
  net:
    driver: "overlay"
    attachable: true
    driver_opts:
      # Hetzner networks have an MTU of 1450
      com.docker.network.driver.mtu: 1450
  traefik-public:
    external: true
